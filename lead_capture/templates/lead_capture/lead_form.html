{% extends "base.html" %}
{% load static %}

{% block title %}Get Your Insurance Quote{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white py-3">
                    <h3 class="text-center mb-0">Find the best insurance quote in under 60 seconds</h3>
                </div>
                
                <div class="card-body p-4">
                    <!-- Progress Bar -->
                    <div class="progress mb-3" style="height: 8px;">
                        <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    
                    <!-- Step Indicator -->
                    <div class="d-flex justify-content-center mb-3">
                        <div id="dot-1" class="rounded-circle bg-primary mx-1" style="width: 12px; height: 12px;"></div>
                        <div id="dot-2" class="rounded-circle bg-light mx-1" style="width: 12px; height: 12px; border: 1px solid #dee2e6;"></div>
                        <div id="dot-3" class="rounded-circle bg-light mx-1" style="width: 12px; height: 12px; border: 1px solid #dee2e6;"></div>
                        <div id="dot-4" class="rounded-circle bg-light mx-1" style="width: 12px; height: 12px; border: 1px solid #dee2e6;"></div>
                    </div>
                    
                    <!-- Time Estimate -->
                    <p class="text-center text-muted small mb-4">Estimated time: <span id="time-estimate">60 seconds</span></p>
                    
                    <form id="lead-form" method="post" action="{% url 'lead_capture:lead_form' code %}">
                        {% csrf_token %}
                        <input type="hidden" id="insurance_type" name="insurance_type">
                        
                        <!-- All steps are contained in separate divs -->
                        <div id="step-1">
                            <h4 class="text-center mb-4">What type of insurance are you looking for?</h4>
                            
                            <div class="row mb-4">
                                <div class="col-md-4 mb-3">
                                    <div class="card h-100 insurance-option" onclick="selectInsurance('auto')">
                                        <div class="card-body text-center p-4">
                                            <i class="bi bi-car-front fs-1 text-primary mb-3"></i>
                                            <h5>Auto Insurance</h5>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="card h-100 insurance-option" onclick="selectInsurance('home')">
                                        <div class="card-body text-center p-4">
                                            <i class="bi bi-house fs-1 text-primary mb-3"></i>
                                            <h5>Home Insurance</h5>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="card h-100 insurance-option" onclick="selectInsurance('business')">
                                        <div class="card-body text-center p-4">
                                            <i class="bi bi-briefcase fs-1 text-primary mb-3"></i>
                                            <h5>Business Insurance</h5>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Step 2: Auto Insurance Form -->
                        <div id="step-2-auto" style="display: none;">
                            <h4 class="text-center mb-4">Tell us about your vehicle</h4>
                            
                            <div class="row mb-3">
                                <div class="col-md-6 mb-3">
                                    <label for="zip_code_auto" class="form-label">ZIP Code</label>
                                    <input type="text" class="form-control" id="zip_code_auto" name="zip_code" placeholder="Enter ZIP code">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="date_of_birth" class="form-label">Date of Birth</label>
                                    <input type="date" class="form-control" id="date_of_birth" name="date_of_birth">
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="vehicle_vin" class="form-label">Vehicle VIN (if known)</label>
                                <input type="text" class="form-control" id="vehicle_vin" name="vehicle_vin" placeholder="Enter VIN to auto-fill vehicle details">
                                <div class="form-text">Don't know your VIN? No problem, we'll ask for your vehicle details next.</div>
                            </div>
                        </div>
                        
                        <!-- Step 2: Home Insurance Form -->
                        <div id="step-2-home" style="display: none;">
                            <h4 class="text-center mb-4">Tell us about your property</h4>
                            
                            <div class="row mb-3">
                                <div class="col-md-6 mb-3">
                                    <label for="zip_code_home" class="form-label">ZIP Code</label>
                                    <input type="text" class="form-control" id="zip_code_home" name="zip_code" placeholder="Enter ZIP code">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="ownership_status" class="form-label">Do you own or rent?</label>
                                    <select class="form-select" id="ownership_status" name="ownership_status">
                                        <option value="">Select one</option>
                                        <option value="own">Own</option>
                                        <option value="rent">Rent</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="address" class="form-label">Street Address</label>
                                <input type="text" class="form-control" id="address" name="address" placeholder="Enter your full street address">
                            </div>
                        </div>
                        
                        <!-- Step 2: Business Insurance Form -->
                        <div id="step-2-business" style="display: none;">
                            <h4 class="text-center mb-4">Tell us about your business</h4>
                            
                            <div class="mb-3">
                                <label for="business_name" class="form-label">Business Name</label>
                                <input type="text" class="form-control" id="business_name" name="business_name" placeholder="Enter business name">
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6 mb-3">
                                    <label for="zip_code_business" class="form-label">ZIP Code</label>
                                    <input type="text" class="form-control" id="zip_code_business" name="zip_code" placeholder="Enter ZIP code">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="industry" class="form-label">Industry</label>
                                    <select class="form-select" id="industry" name="industry">
                                        <option value="">Select industry</option>
                                        <option value="retail">Retail</option>
                                        <option value="hospitality">Hospitality</option>
                                        <option value="technology">Technology</option>
                                        <option value="manufacturing">Manufacturing</option>
                                        <option value="construction">Construction</option>
                                        <option value="professional">Professional Services</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="num_employees" class="form-label">Number of Employees</label>
                                <input type="number" class="form-control" id="num_employees" name="num_employees" placeholder="Enter number of employees">
                            </div>
                        </div>
                        
                        <!-- Step 3: Contact Information (Common for all types) -->
                        <div id="step-3" style="display: none;">
                            <h4 class="text-center mb-4">Your Contact Information</h4>
                            
                            <div class="mb-3">
                                <label for="name" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="name" name="name" placeholder="Enter your full name" required>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6 mb-3">
                                    <label for="email" class="form-label">Email Address</label>
                                    <input type="email" class="form-control" id="email" name="email" placeholder="Enter your email address" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="phone" class="form-label">Phone Number</label>
                                    <input type="tel" class="form-control" id="phone" name="phone" placeholder="Enter your phone number" required>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6 mb-3">
                                    <label for="preferred_contact_method" class="form-label">Preferred Contact Method</label>
                                    <select class="form-select" id="preferred_contact_method" name="preferred_contact_method">
                                        <option value="phone">Phone Call</option>
                                        <option value="email">Email</option>
                                        <option value="text">Text Message</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="preferred_time" class="form-label">Best Time to Contact</label>
                                    <select class="form-select" id="preferred_time" name="preferred_time">
                                        <option value="morning">Morning</option>
                                        <option value="afternoon">Afternoon</option>
                                        <option value="evening">Evening</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="notes" class="form-label">Additional Information</label>
                                <textarea class="form-control" id="notes" name="notes" rows="3" placeholder="Any additional details you'd like us to know?"></textarea>
                            </div>
                        </div>
                        
                        <!-- Step 4: Review & Submit -->
                        <div id="step-4" style="display: none;">
                            <h4 class="text-center mb-4">Review Your Information</h4>
                            
                            <div class="card mb-4">
                                <div class="card-body">
                                    <div id="summary-content">
                                        <!-- Will be populated with JavaScript -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="agree-terms" required>
                                    <label class="form-check-label" for="agree-terms">
                                        I agree to be contacted by an insurance agent regarding my quote.
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Navigation Buttons -->
                        <div class="d-flex justify-content-between mt-4">
                            <button type="button" id="prev-btn" class="btn btn-outline-secondary" style="display: none;">Previous</button>
                            <div class="ms-auto">
                                <button type="button" id="next-btn" class="btn btn-primary">Next</button>
                                <button type="submit" id="submit-btn" class="btn btn-success" style="display: none;">Submit</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Global variables
let currentStep = 1;
let insuranceType = '';
let totalSteps = 4;

// Elements
const insuranceOptions = document.querySelectorAll('.insurance-option');
const insuranceTypeInput = document.getElementById('insurance_type');
const prevBtn = document.getElementById('prev-btn');
const nextBtn = document.getElementById('next-btn');
const submitBtn = document.getElementById('submit-btn');
const progressBar = document.getElementById('progress-bar');
const timeEstimate = document.getElementById('time-estimate');
const step1 = document.getElementById('step-1');
const step2Auto = document.getElementById('step-2-auto');
const step2Home = document.getElementById('step-2-home');
const step2Business = document.getElementById('step-2-business');
const step3 = document.getElementById('step-3');
const step4 = document.getElementById('step-4');
const summaryContent = document.getElementById('summary-content');

// Function to select insurance type
function selectInsurance(type) {
    // Reset all cards
    insuranceOptions.forEach(option => {
        option.classList.remove('border-primary');
        option.classList.remove('bg-light');
    });
    
    // Highlight selected card
    const selectedCard = document.querySelector(`.insurance-option[onclick="selectInsurance('${type}')"]`);
    selectedCard.classList.add('border-primary');
    selectedCard.classList.add('bg-light');
    
    // Set insurance type
    insuranceType = type;
    insuranceTypeInput.value = type;
    
    console.log('Selected insurance type:', type);
}

// Function to go to next step
nextBtn.addEventListener('click', function() {
    // Validate current step
    if (currentStep === 1 && !insuranceType) {
        alert('Please select an insurance type to continue');
        return;
    }
    
    // Hide current step
    hideCurrentStep();
    
    // Advance to next step
    currentStep++;
    
    // Show new step
    showCurrentStep();
    
    // Update UI
    updateUI();
    
    // Generate summary if on final step
    if (currentStep === 4) {
        generateSummary();
    }
});

// Function to go to previous step
prevBtn.addEventListener('click', function() {
    // Hide current step
    hideCurrentStep();
    
    // Go back to previous step
    currentStep--;
    
    // Show new step
    showCurrentStep();
    
    // Update UI
    updateUI();
});

// Function to hide current step
function hideCurrentStep() {
    if (currentStep === 1) {
        step1.style.display = 'none';
    } else if (currentStep === 2) {
        if (insuranceType === 'auto') step2Auto.style.display = 'none';
        else if (insuranceType === 'home') step2Home.style.display = 'none';
        else if (insuranceType === 'business') step2Business.style.display = 'none';
    } else if (currentStep === 3) {
        step3.style.display = 'none';
    } else if (currentStep === 4) {
        step4.style.display = 'none';
    }
}

// Function to show current step
function showCurrentStep() {
    if (currentStep === 1) {
        step1.style.display = 'block';
    } else if (currentStep === 2) {
        if (insuranceType === 'auto') step2Auto.style.display = 'block';
        else if (insuranceType === 'home') step2Home.style.display = 'block';
        else if (insuranceType === 'business') step2Business.style.display = 'block';
    } else if (currentStep === 3) {
        step3.style.display = 'block';
    } else if (currentStep === 4) {
        step4.style.display = 'block';
    }
}

// Function to update UI elements
function updateUI() {
    // Update progress bar
    const progress = ((currentStep - 1) / (totalSteps - 1)) * 100;
    progressBar.style.width = `${progress}%`;
    progressBar.setAttribute('aria-valuenow', progress);
    
    // Update step dots
    for (let i = 1; i <= 4; i++) {
        const dot = document.getElementById(`dot-${i}`);
        if (i <= currentStep) {
            dot.classList.remove('bg-light');
            dot.classList.add('bg-primary');
        } else {
            dot.classList.remove('bg-primary');
            dot.classList.add('bg-light');
        }
    }
    
    // Update time estimate
    const timeEstimates = ['60 seconds', '45 seconds', '30 seconds', '15 seconds'];
    timeEstimate.textContent = timeEstimates[currentStep - 1];
    
    // Show/hide navigation buttons
    if (currentStep > 1) {
        prevBtn.style.display = 'block';
    } else {
        prevBtn.style.display = 'none';
    }
    
    if (currentStep < totalSteps) {
        nextBtn.style.display = 'block';
        submitBtn.style.display = 'none';
    } else {
        nextBtn.style.display = 'none';
        submitBtn.style.display = 'block';
    }
}

// Function to generate summary
function generateSummary() {
    const form = document.getElementById('lead-form');
    const formData = new FormData(form);
    
    let summary = '<div class="list-group list-group-flush">';
    
    // Insurance type
    summary += `<div class="list-group-item"><strong>Insurance Type:</strong> ${insuranceType.charAt(0).toUpperCase() + insuranceType.slice(1)} Insurance</div>`;
    
    // Add contact info
    const name = formData.get('name');
    const email = formData.get('email');
    const phone = formData.get('phone');
    
    if (name) summary += `<div class="list-group-item"><strong>Name:</strong> ${name}</div>`;
    if (email) summary += `<div class="list-group-item"><strong>Email:</strong> ${email}</div>`;
    if (phone) summary += `<div class="list-group-item"><strong>Phone:</strong> ${phone}</div>`;
    
    // Add type-specific info
    if (insuranceType === 'auto') {
        const zipCode = formData.get('zip_code');
        const dob = formData.get('date_of_birth');
        const vin = formData.get('vehicle_vin');
        
        if (zipCode) summary += `<div class="list-group-item"><strong>ZIP Code:</strong> ${zipCode}</div>`;
        if (dob) summary += `<div class="list-group-item"><strong>Date of Birth:</strong> ${dob}</div>`;
        if (vin) summary += `<div class="list-group-item"><strong>VIN:</strong> ${vin}</div>`;
    } else if (insuranceType === 'home') {
        const zipCode = formData.get('zip_code');
        const address = formData.get('address');
        const ownershipStatus = formData.get('ownership_status');
        
        if (zipCode) summary += `<div class="list-group-item"><strong>ZIP Code:</strong> ${zipCode}</div>`;
        if (address) summary += `<div class="list-group-item"><strong>Address:</strong> ${address}</div>`;
        if (ownershipStatus) {
            const status = ownershipStatus === 'own' ? 'Owner' : 'Renter';
            summary += `<div class="list-group-item"><strong>Ownership:</strong> ${status}</div>`;
        }
    } else if (insuranceType === 'business') {
        const businessName = formData.get('business_name');
        const zipCode = formData.get('zip_code');
        const industry = formData.get('industry');
        const employees = formData.get('num_employees');
        
        if (businessName) summary += `<div class="list-group-item"><strong>Business Name:</strong> ${businessName}</div>`;
        if (zipCode) summary += `<div class="list-group-item"><strong>ZIP Code:</strong> ${zipCode}</div>`;
        if (industry) summary += `<div class="list-group-item"><strong>Industry:</strong> ${industry}</div>`;
        if (employees) summary += `<div class="list-group-item"><strong>Employees:</strong> ${employees}</div>`;
    }
    
    summary += '</div>';
    summaryContent.innerHTML = summary;
}

// Add this at the end of your script section
document.getElementById('submit-btn').addEventListener('click', function(e) {
    e.preventDefault(); // Prevent default form submission
    
    // Get the form data
    const form = document.getElementById('lead-form');
    
    // Ensure the insurance type is correctly set
    document.getElementById('insurance_type').value = insuranceType;
    
    // Submit the form
    console.log("Submitting form...");
    form.submit();
});
</script>
{% endblock %}